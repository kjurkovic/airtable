# syntax=docker/dockerfile:1

FROM golang:1.18
WORKDIR /app

COPY go.mod ./
COPY go.sum ./
RUN go mod download

COPY . ./

ENV SERVER_PORT $SERVER_PORT
ENV DATABASE_NAME $DATABASE_NAME
ENV DATABASE_HOST $DATABASE_HOST
ENV DATABASE_PORT $DATABASE_PORT
ENV DATABASE_SCHEMA $DATABASE_SCHEMA
ENV DATABASE_USER $DATABASE_USER
ENV DATABASE_PASSWORD $DATABASE_PASSWORD
ENV JWT_SECRET $JWT_SECRET
ENV SERVER_ALLOWED_ORIGINS $SERVER_ALLOWED_ORIGINS
ENV SERVER_DEBUG_MODE $SERVER_DEBUG_MODE
ENV AUDIT_SERVICE_HOST $AUDIT_SERVICE_HOST
ENV SERVER_SYSTEM_UUID $SERVER_SYSTEM_UUID

RUN go build -o ./app
EXPOSE $PORT
CMD [ "./app" ]
